source(r/functions.R)
source("r/functions.R")
source("./r/functions.R")
source("r/functions.R")
setwd("C:/Users/Administrador.000/Desktop/Sebastian/Repos/diabetes")
source("r/functions.R")
binary.partition<-function(dataset,pct,variable){
numvar<-which(colnames(dataset)=="variable")
dataset<-arrange_(dataset,.dots=(paste("desc(",variable,")",sep="")))
n<-nrow(dataset)
ones<-sum(dataset[,variable])
zeros<-nrow(dataset)-ones
partones<-map(pct,~round(.*ones))
partzeros<-map(pct,~round(.*zeros))
suma<-sum(flatten_dbl(partzeros))+sum(flatten_dbl(partones))
a<-cumsum(flatten_dbl(partones))
b<-cumsum(flatten_dbl(partzeros))
dataones<-dataset[1:ones,]
datazeros<-dataset[(ones+1):nrow(dataset),]
train<-bind_rows(dataones[1:a[1],],datazeros[1:b[1],])
validate<-bind_rows(dataones[(a[1]+1):a[2],],
datazeros[(b[1]+1):b[2],])
test<-bind_rows(dataones[(a[2]+1):nrow(dataones),],
datazeros[(b[2]+1):nrow(datazeros),])
lista<-list(train,validate,test)
names(lista)<-c("train","validate","test")
return(lista)
}
library(tidyverse)
library(MASS)
library(rpart)
library(naivebayes)
library(class)
library(modelr)
library(caret)
library(tree)
library(rattle)
library(rpart.plot)
library(RColorBrewer)
library(klaR)
source("r/functions.R")
dataset<-read_csv("data/diabetes.txt",col_names=c("timespreg","plaglu",
"diastolic","triceps",
"serum","bmi","diabped",
"age","diabetes"))
plotlist<-multiplehist(dataset)
histograms<-multiplot(plotlist = plotlist,cols=3)
cor(dataset)
ggplot()+geom_tile(data=cor(dataset),aes(x=var1, y=var2,fill=value))
gather(cor(dataset),key = var2,value = value)
gather(as.data.frame(cor(dataset)),key = var2,value = value)
as.data.frame(cor(dataset))
a<-as.data.frame(cor(dataset))
a<-rownames_to_column(a,var = var1)
a<-rownames_to_column(a,var = "var1")
gather(a,key = var2,value = value)
a<-as.data.frame(cor(dataset))
a
a<-rownames_to_column(a,var = "var1")
a
View(a)
View(a)
gather(a,key = var2,value = value)
gather(a,timespreg:diabetes,key = var2,value = value)
a<-gather(a,timespreg:diabetes,key = var2,value = value)
ggplot()+geom_tile(data=cor(dataset),aes(x=var1, y=var2,fill=value))
ggplot()+geom_tile(data=a,aes(x=var1, y=var2,fill=value))
corr<-as.data.frame(cor(dataset)) %>%
rownames_to_column(var = "var1") %>%
gather(a,timespreg:diabetes,key = var2,value = value)
corr<-as.data.frame(cor(dataset)) %>%
rownames_to_column(var = "var1") %>%
gather(timespreg:diabetes,key = var2,value = value)
ggplot()+geom_tile(data=corr,aes(x=var1, y=var2,fill=value))
ggplot()+geom_tile(data=corr,aes(x=var2, y=var1,fill=value))
colSums(dataset==0)
prop.table(dataset$diabetes)
table(dataset$diabetes)
colSums(is.na(dataset))
colSums(dataset==0)
View(corr)
ggplot()+geom_tile(data=corr,aes(x=var2, y=parse_factor(var1),fill=value))
ggplot()+geom_tile(data=corr,aes(x=var2, y=parse_factor(var1,levels=colnames(dataset)),fill=value))
ggplot()+geom_tile(data=corr,aes(x=parse_factor(var2,levels=colnames(dataset)), y=parse_factor(var1,levels=colnames(dataset)),fill=value))
ggplot()+geom_tile(data=corr,aes(x=var1, y=var2,fill=value))
finaldataset<-dataset[dataset$plaglu!=0,]
finaldataset<-finaldataset[finaldataset$bmi!=0,]
finaldataset<-finaldataset[,c(-4,-5)]
diastolic<-dataset[dataset$diastolic!=0,]
mu<-mean(diastolic$diastolic)
finaldataset<-mutate(finaldataset,diastolic=ifelse(diastolic==0,mu,diastolic))
rm(diastolic)
normalize<-as.data.frame(scale(finaldataset[,-7]))
normalize$diabetes<-finaldataset$diabetes
finaldataset$diabetes<-parse_factor(finaldataset$diabetes,levels=c("Yes","No"))
finaldataset$diabetes<-parse_factor(finaldataset$diabetes,levels=c(0,1))
View(finaldataset)
View(finaldataset)
finaldataset<-dataset[dataset$plaglu!=0,]
finaldataset<-finaldataset[finaldataset$bmi!=0,]
finaldataset<-finaldataset[,c(-4,-5)]
diastolic<-dataset[dataset$diastolic!=0,]
mu<-mean(diastolic$diastolic)
finaldataset<-mutate(finaldataset,diastolic=ifelse(diastolic==0,mu,diastolic))
rm(diastolic)
finaldataset$diabetes<-factor(finaldataset$diabetes,levels=c("Yes","No"))
finaldataset<-dataset[dataset$plaglu!=0,]
finaldataset<-finaldataset[finaldataset$bmi!=0,]
finaldataset<-finaldataset[,c(-4,-5)]
diastolic<-dataset[dataset$diastolic!=0,]
mu<-mean(diastolic$diastolic)
finaldataset<-mutate(finaldataset,diastolic=ifelse(diastolic==0,mu,diastolic))
rm(diastolic)
finaldataset$diabetes<-factor(finaldataset$diabetes,levels=c(0,1))
str(finaldataset$diabetes)
levels(finaldataset$diabetes)
table(finaldataset$diabetes)
levels(finaldataset$diabetes)<-levels(c("No","Yes"))
levels(finaldataset$diabetes)<-levels(finaldataset$diabetes,c("No","Yes"))
levels(finaldataset$diabetes)<-c("No","Yes")
table(finaldataset$diabetes)
dataset$diabetes<-factor(dataset$diabetes,levels=c(0,1))
levels(dataset$diabetes)<-c("No","Yes")
corr<-as.data.frame(cor(dataset)) %>%
rownames_to_column(var = "var1") %>%
gather(timespreg:diabetes,key = var2,value = value)
corr<-as.data.frame(cor(dataset)) %>%
rownames_to_column(var = "var1") %>%
gather(timespreg:diabetes,key = var2,value = value)
corr<-as.data.frame(cor(dataset[,-9])) %>%
rownames_to_column(var = "var1") %>%
gather(timespreg:diabetes,key = var2,value = value)
corr<-as.data.frame(cor(dataset[,-9])) %>%
rownames_to_column(var = "var1") %>%
gather(timespreg:age,key = var2,value = value)
ggplot()+geom_tile(data=corr,aes(x=var1, y=var2,fill=value))
finaldataset<-dataset[dataset$plaglu!=0,]
finaldataset<-finaldataset[finaldataset$bmi!=0,]
finaldataset<-finaldataset[,c(-4,-5)]
diastolic<-dataset[dataset$diastolic!=0,]
mu<-mean(diastolic$diastolic)
finaldataset<-mutate(finaldataset,diastolic=ifelse(diastolic==0,mu,diastolic))
rm(diastolic)
trainidx<-createDataPartition(y = finaldataset$diabetes,
times = 2,list = FALSE,p = 0.7)
View(trainidx)
View(trainidx)
trainidx<-createDataPartition(y = finaldataset$diabetes,
list = FALSE,p = 0.7)
train<-finaldataset[trainidx,]
notrain<-finaldataset[-trainidx,]
testidx<-createDataPartition(y=notrain$diabetes,list=FALSE,p=0.5)
test<-notrain[testidx,]
validate<-notrain[-testidx,]
mean(train$diabetes)
table(train$diabetes)
table(test$diabetes)
table(validate$diabetes)
table(train$diabetes)/nrow(train)
table(test$diabetes)/nrow(test)
table(validate$diabetes)/nrow(validate)
set.seed(1234)
trainidx<-createDataPartition(y = finaldataset$diabetes,
list = FALSE,p = 0.7)
train<-finaldataset[trainidx,]
notrain<-finaldataset[-trainidx,]
testidx<-createDataPartition(y=notrain$diabetes,list=FALSE,p=0.5)
test<-notrain[testidx,]
validate<-notrain[-testidx,]
table(train$diabetes)/nrow(train)
table(test$diabetes)/nrow(test)
table(validate$diabetes)/nrow(validate)
dtree<-rpart(diabetes~.,data=train,method="class")
dtree<-rpart(diabetes~.,data=train,method="class")
summary(dtree)
plot(dtree)
text(dtree,use.n=TRUE,all=TRUE,cex=0.9,)
plot(dtree)
text(dtree,use.n=TRUE,all=TRUE,cex=0.5)
plot(dtree)
text(dtree,use.n=TRUE,cex=0.5)
text(dtree,use.n=TRUE,cex=0.5,fancy = TRUE)
plot(dtree)
text(dtree,use.n=TRUE,cex=0.5,pretty = 0)
fancyRpartPlot(dtree)
text(dtree,use.n=TRUE,cex=0.5,all=TRUE)
plot(dtree)
text(dtree,use.n=TRUE,cex=0.5,all=TRUE)
rpart.plot(dtree)
rpart.plot(dtree,type=1)
plot(dtree,uniform = TRUE)
text(dtree,use.n=TRUE,cex=0.5,all=TRUE)
plot(dtree,uniform = TRUE,compress=TRUE)
text(dtree,use.n=TRUE,cex=0.5,all=TRUE)
plot(dtree,uniform = TRUE,compress=TRUE,margin=1)
plot(dtree,uniform = TRUE,compress=TRUE,margin=0.2)
text(dtree,use.n=TRUE,cex=0.5,all=TRUE)
plot(dtree,uniform = TRUE,compress=TRUE,margin=0.2)
text(dtree,use.n=TRUE,cex=0.3)
plot(dtree,uniform = TRUE,margin=0.2)
text(dtree,use.n=TRUE,cex=0.3)
plot(dtree,uniform = TRUE,margin=0.2)
text(dtree,use.n=TRUE,cex=0.5)
text(dtree,all=TRUE,cex=0.5)
plot(dtree,uniform = TRUE,margin=0.2)
text(dtree,all=TRUE,cex=0.5)
text(dtree,all=TRUE,use_n=TRUE,cex=0.5)
plot(dtree,margin=0.2)
text(dtree,all=TRUE,use.n = TRUE,cex=0.5)
text(dtree,all=TRUE,use.n = TRUE,cex=0.5)
text(dtree,all=TRUE,use.n = TRUE,cex=0.5)
printcp(decisiontree)
printcp(dtree)
printcp(dtree)
?rpart
printcp(dtree)
0.44*185
0.44324/81
0.44324*185
